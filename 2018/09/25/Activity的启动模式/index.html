<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="XduhSicqEvrM2t-u9VmdvMz9IRuhPIUGL7siQFpADQg" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.png?v=5.1.3" color="#222">





  <meta name="keywords" content="Android," />










<meta name="description" content="Activity的启动模式任务栈一个application在启动的时候，能有很多个activity，我们在按下back键的时候，会回退到上一个activity，那么系统是如何来管理这些activity呢？答案是以栈(task)的形式，遵循先进后出的原则，默认情况下，一个app只有一个任务栈(task)，如果需要，我们可以指定多个任务栈(task)">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content=" Activity的启动模式">
<meta property="og:url" content="http://zhangbing.cc/2018/09/25/Activity的启动模式/index.html">
<meta property="og:site_name" content="Ace的技术客栈">
<meta property="og:description" content="Activity的启动模式任务栈一个application在启动的时候，能有很多个activity，我们在按下back键的时候，会回退到上一个activity，那么系统是如何来管理这些activity呢？答案是以栈(task)的形式，遵循先进后出的原则，默认情况下，一个app只有一个任务栈(task)，如果需要，我们可以指定多个任务栈(task)">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-09-25T06:59:31.652Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" Activity的启动模式">
<meta name="twitter:description" content="Activity的启动模式任务栈一个application在启动的时候，能有很多个activity，我们在按下back键的时候，会回退到上一个activity，那么系统是如何来管理这些activity呢？答案是以栈(task)的形式，遵循先进后出的原则，默认情况下，一个app只有一个任务栈(task)，如果需要，我们可以指定多个任务栈(task)">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhangbing.cc/2018/09/25/Activity的启动模式/"/>





  <title> Activity的启动模式 | Ace的技术客栈</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f4df925f5ecaae00a62621ca00acdaae";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ace的技术客栈</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">业精于勤荒于嬉 行成于思毁于随</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhangbing.cc/2018/09/25/Activity的启动模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ace">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ace的技术客栈">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline"> Activity的启动模式</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-25T12:59:00+08:00">
                2018-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,989
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  17
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Activity的启动模式"><a href="#Activity的启动模式" class="headerlink" title="Activity的启动模式"></a>Activity的启动模式</h2><h3 id="任务栈"><a href="#任务栈" class="headerlink" title="任务栈"></a>任务栈</h3><p>一个application在启动的时候，能有很多个activity，我们在按下back键的时候，会回退到上一个activity，那么系统是如何来管理这些activity呢？答案是以栈(task)的形式，遵循先进后出的原则，默认情况下，一个app只有一个任务栈(task)，如果需要，我们可以指定多个任务栈(task)</p>
<a id="more"></a>
<blockquote>
<ol>
<li>任务栈是app管理activity的一种容器，遵循先进后出原则 </li>
<li>一个app默认只有一个任务栈，由系统指定 </li>
<li>一个app可以有多个任务栈，需要我们自己指定</li>
</ol>
</blockquote>
<h3 id="四个启动模式"><a href="#四个启动模式" class="headerlink" title="四个启动模式"></a>四个启动模式</h3><ol>
<li><p><strong>standard</strong>：标准启动模式（默认启动模式），每次都会启动一个新的activity实例。</p>
</li>
<li><p><strong>singleTop</strong>：单独使用使用这种模式时，如果Activity实例位于<strong>当前任务栈顶，就重用栈顶实例，而不新建</strong>，并回调该实例<strong>onNewIntent()</strong>方法，否则走新建流程。</p>
</li>
<li><p><strong>singleTask</strong>：这种模式启动的Activity只会存在相应的Activity的taskAffinit任务栈中，同一时刻系统中<strong>只会存在一个实例</strong>，已存在的实例被再次启动时，会重新唤起该实例，并清理当前Task任务栈该实例之上的所有Activity，同时回调<strong>onNewIntent()</strong>方法,如果系统中已经存在这样一个实例，就会将这个实例调度到任务栈的栈顶，并<strong>清除</strong>它当前所在任务中位于它上面的所有的activity</p>
</li>
</ol>
<ol>
<li><strong>singleInstance</strong>：这种模式启动的Activity独自占用一个Task任务栈，同一时刻系统中只会存在一个实例，已存在的实例被再次启动时，只会唤起原实例，并回调onNewIntent()方法。</li>
</ol>
<h2 id="taskAffinity属性详解"><a href="#taskAffinity属性详解" class="headerlink" title="taskAffinity属性详解"></a>taskAffinity属性详解</h2><p>当我们想自己手动给一个activity配置task的时候，要怎么操作呢<br>这就得提到一个重要的属性了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:taskAffinity</div></pre></td></tr></table></figure>
<p>官方文档:</p>
<blockquote>
<p>The task that the activity has an affinity for. Activities with the same affinity conceptually belong to the same task (to the same “application” from the user’s perspective). The affinity of a task is determined by the affinity of its root activity.<br>The affinity determines two things — the task that the activity is re-parented to (see the allowTaskReparenting attribute) and the task that will house the activity when it is launched with the FLAG_ACTIVITY_NEW_TASK flag.</p>
<p>By default, all activities in an application have the same affinity. You can set this attribute to group them differently, and even place activities defined in different applications within the same task. To specify that the activity does not have an affinity for any task, set it to an empty string.</p>
<p>If this attribute is not set, the activity inherits the affinity set for the application (see the <application> element’s taskAffinity attribute). The name of the default affinity for an application is the package name set by the <manifest> element.</manifest></application></p>
</blockquote>
<p>翻译:</p>
<p>taskAffinity是activity的任务栈的相关性。拥有相同affinity的activity在概念上属于同一个task。一个task的affinity取决于这个task内的根activity的taskaffinity。taskaffinity属性能决定两件事：<br>①.当activity被re-parent时，他会被放到哪个任务栈中.<br>②.当此activity被添加 FLAG_ACTIVITY_NEW_TASK 标记启动的时候，会被放入哪个task中。<br>默认情况下，application中所有的activity拥有相同的affinity，你可以通过给taskaffinity属性设置不同的值把他们分组。甚至可以把多个application中的activity放到同一个task中。如果想明确这个activity不属于任何task，把这个属性设置为空字符即可。<br>如果这个属性没有被设置，那么此属性的值就继承自application的此属性的值（查看 application的taskaffinity属性）。默认的值为application的包名。</p>
<p>1.taskAffinity属性能够给activity指定task，但必须使用FLAG_ACTIVITY_NEW_TASK 标记。<br>2.默认的taskAffinity的值是应用的包名。</p>
<h3 id="通过TaskAffinity-设置新的任务栈"><a href="#通过TaskAffinity-设置新的任务栈" class="headerlink" title="通过TaskAffinity 设置新的任务栈"></a>通过TaskAffinity 设置新的任务栈</h3><p>taskAffinity，任务相关性。xml中的一个属性，标识了一个Activity所需要的任务栈的名字。默认是包名。如果设置了其他的名字如com.test.task1，那启动它的时候就会新建一个名为com.test.task1的任务栈。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;activity</div><div class="line">    android:name=&quot;com.test.task0.MainActivity&quot;</div><div class="line">    android:label=&quot;@string/app_name&quot;</div><div class="line">    android:launchMode=&quot;standard&quot;&gt;</div><div class="line">    &lt;intent-filter&gt;</div><div class="line">        &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line">        &lt;category andorid:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line">    &lt;/intent-filter&gt;</div><div class="line">&lt;/activity&gt;</div><div class="line"></div><div class="line">&lt;activity</div><div class="line">    andorid:name=&quot;com.test.SecondActivity&quot;</div><div class="line">    android:taskAffinity=&quot;com.test.task1&quot;</div><div class="line">    android:label=&quot;@string/app_name&quot;</div><div class="line">    android:launchMode=&quot;singleTask&quot;/&gt;</div><div class="line"></div><div class="line">&lt;activity</div><div class="line">    andorid:name=&quot;com.test.ThirdActivity&quot;</div><div class="line">    android:taskAffinity=&quot;com.test.task1&quot;</div><div class="line">    android:label=&quot;@string/app_name&quot;</div><div class="line">    android:launchMode=&quot;singleTask&quot;/&gt;</div></pre></td></tr></table></figure>
<h4 id="栗子"><a href="#栗子" class="headerlink" title="栗子:"></a>栗子:</h4><p>如果从MainActivity启动SecondActivity，然后再启动ThirdActivity，那么任务栈如下：</p>
<blockquote>
<p>Blockquotes com.test.task0 MainActivity<br>Blockquotes com.test.task1 SecondActivity ThirdActivity<br>若再从ThirdActivity启动MainActivity，那么任务栈如下：<br>com.test.task0 MainActivity<br>com.test.task1 SecondActivity ThirdActivity MainActivity.<br>总结：通过设置 TaskAffinity 属性更改任务栈属性。</p>
</blockquote>
<h2 id="allowTaskReparenting属性"><a href="#allowTaskReparenting属性" class="headerlink" title="allowTaskReparenting属性"></a>allowTaskReparenting属性</h2><p>官方api这样解释的：</p>
<blockquote>
<p>Whether or not the activity can move from the task that started it to the task it has an affinity for when that task is next brought to the front — “true” if it can move, and “false” if it must remain with the task where it started.</p>
</blockquote>
<p>大概意思是说，如果设为“true”,那么activity可以从启动它的task中移动到和此activity相关的task中。听完我这个解释，你估计还是不明白，<br>举个例子吧：有A和B两个应用，B应用有一个activityC，并且activityC的allowTaskReparenting属性为true。现在有这样一个场景，A启动了B的activityC，然后点击home键回到桌面，在启动B应用，这个时候不是启动B应用的mainActivity，而是重新显示了activityC，activityC从A的任务栈转移到了B的任务栈（因为和activityC相关的task就是appB的task，所以把activityC加到栈顶）。</p>
<h2 id="Intent与启动模式相关的Flag简介"><a href="#Intent与启动模式相关的Flag简介" class="headerlink" title="Intent与启动模式相关的Flag简介"></a>Intent与启动模式相关的Flag简介</h2><p>这里仅仅对几个常用的与启动模式相关的Flag进行介绍。</p>
<p><strong>FLAG_ACTIVITY_NEW_TASK</strong><br>在google的官方文档中介绍，它与launchMode=”<strong>singleTask</strong>“具有相同的行为。实际上，并不是完全相同！<br>很少单独使用<strong>FLAG_ACTIVITY_NEW_TASK</strong>，通常与<strong>FLAG_ACTIVITY_CLEAR_TASK</strong>或<strong>FLAG_ACTIVITY_CLEAR_TOP</strong>联合使用。因为单独使用该属性会导致奇怪的现象，通常达不到我们想要的效果！</p>
<p>设置此状态，记住以下原则，首先会查找是否存在和被启动的Activity具有相同的亲和性的任务栈（即taskAffinity，注意同一个应用程序中的activity的亲和性一样，所以下面的a情况会在同一个栈中)，如果有，刚直接把这个栈整体移动到前台，并保持栈中的状态不变，即栈中的activity顺序不变，如果没有，则新建一个栈来存放被启动的activity。</p>
<p>尽管如何，后面还是会通过”FLAG_ACTIVITY_NEW_TASK示例一”和”FLAG_ACTIVITY_NEW_TASK示例二”会向你展示单独使用它的效果。</p>
<p><strong>FLAG_ACTIVITY_SINGLE_TOP</strong><br>在google的官方文档中介绍，它与launchMode=”singleTop”具有相同的行为。实际上，的确如此！单独的使用FLAG_ACTIVITY_SINGLE_TOP，就能达到和launchMode=”singleTop”一样的效果。</p>
<p><strong>FLAG_ACTIVITY_CLEAR_TOP</strong><br>顾名思义，<strong>FLAG_ACTIVITY_CLEAR_TOP</strong>的作用清除”包含Activity的task”中位于该Activity实例之上的其他Activity实例。FLAG_ACTIVITY_CLEAR_TOP和FLAG_ACTIVITY_NEW_TASK两者同时使用，就能达到和launchMode=”singleTask”一样的效果！</p>
<p><strong>FLAG_ACTIVITY_CLEAR_TASK</strong><br><strong>FLAG_ACTIVITY_CLEAR_TASK</strong>的作用包含Activity的task。使用FLAG_ACTIVITY_CLEAR_TASK时，通常会包含FLAG_ACTIVITY_NEW_TASK。这样做的目的是启动Activity时，清除之前已经存在的Activity实例所在的task；这自然也就清除了之前存在的Activity实例！</p>
<p><strong>注意：</strong>当同时使用launchMode和上面的FLAG_ACTIVITY_NEW_TASK等标签时，以FLAG_ACTIVITY_NEW_TASK为标准。也就是说，<strong>代码的优先级比manifest中配置文件的优先级更高</strong>！</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>下面，通过几个实例加深对这几个标记的理解。</p>
<ol>
<li>FLAG_ACTIVITY_NEW_TASK标签测试</li>
</ol>
<p>1.1 FLAG_ACTIVITY_NEW_TASK示例一<br>点击查看：FLAG_ACTIVITY_NEW_TASK示例一的源码</p>
<p>在该实例中，有两个Activity：ActivityTest和SecondActivity。manifest定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;application android:label=&quot;@string/app_name&quot; android:icon=&quot;@drawable/ic_launcher&quot;&gt;</div><div class="line">    &lt;activity android:name=&quot;ActivityTest&quot;</div><div class="line">              android:label=&quot;@string/app_name&quot;&gt;</div><div class="line">        &lt;intent-filter&gt;</div><div class="line">            &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line">            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line">        &lt;/intent-filter&gt;</div><div class="line">    &lt;/activity&gt;</div><div class="line"></div><div class="line">    &lt;activity android:name=&quot;SecondActivity&quot; /&gt;</div><div class="line">&lt;/application&gt;</div></pre></td></tr></table></figure>
<p>说明：通过manifest可以看出，ActivityTest和SecondActivity在同一个APK中。这也就意味着它们的android:taskAffinity是一样的！</p>
<p>ActivityTest的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActivityTest</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG=<span class="string">"##ActivityTest##"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.main);</div><div class="line"></div><div class="line">        Log.d(TAG, <span class="string">"onCreate: "</span>+<span class="keyword">this</span>.toString()+<span class="string">", taskId="</span>+<span class="keyword">this</span>.getTaskId());</div><div class="line">        TextView tv = (TextView) findViewById(R.id.tv);</div><div class="line">        tv.setText(<span class="keyword">this</span>.toString()+<span class="string">", taskId="</span>+<span class="keyword">this</span>.getTaskId());</div><div class="line">    &#125;   </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onJump</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class);</div><div class="line">        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;   </div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onNewIntent</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"onNewIntent: intent="</span>+intent+<span class="string">", activity="</span>+<span class="keyword">this</span>+<span class="string">", taskId="</span>+<span class="keyword">this</span>.getTaskId());</div><div class="line">    &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>说明：onJump()是ActivityTest中一个按钮的回调函数，点击该按钮会跳转到SecondActivity。注意，跳转的Intent添加了FLAG_ACTIVITY_NEW_TASK标志。</p>
<p>SecondActivity的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG=<span class="string">"##SecondActivity##"</span>;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.second);</div><div class="line"></div><div class="line">        Log.d(TAG, <span class="string">"onCreate: "</span>+<span class="keyword">this</span>.toString()+<span class="string">", taskId="</span>+<span class="keyword">this</span>.getTaskId());</div><div class="line">        TextView tv = (TextView) findViewById(R.id.tv2);</div><div class="line">        tv.setText(<span class="keyword">this</span>.toString()+<span class="string">", taskId="</span>+<span class="keyword">this</span>.getTaskId());</div><div class="line">    &#125;   </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBack</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ActivityTest.class);</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;   </div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onNewIntent</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"onNewIntent: intent="</span>+intent+<span class="string">", activity="</span>+<span class="keyword">this</span>+<span class="string">", taskId="</span>+<span class="keyword">this</span>.getTaskId());</div><div class="line">    &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>说明：onBack()是SecondActivity中一个按钮的回调函数，点击该按钮会跳转回ActivityTest。</p>
<p>测试内容：ActivityTest –&gt; SecondActivity –&gt; ActivityTest –&gt; SecondActivity<br>测试结果：(01) ActivityTest和SecondActivity在同一个task中。 (02) 两个SecondActivity不同的实例！<br>结果分析：如果说FLAG_ACTIVITY_NEW_TASK的作用和singleTask具有相同的效果。那么这个示例很明显的否则了这个结论！事实上，在相互跳转的两个Activity的android:taskAffinity相同的情况下，单独使用FLAG_ACTIVITY_NEW_TASK不会产生任何效果！</p>
<p>那如果两个Activity的android:taskAffinity不相同呢？此时会导致什么效果呢？下面，我们通过示例来看看效果。</p>
<p>1.2 FLAG_ACTIVITY_NEW_TASK示例二<br>点击查看：FLAG_ACTIVITY_NEW_TASK示例二的源码</p>
<p>我们修改”FLAG_ACTIVITY_NEW_TASK示例一”中manifest，将ActivityTest和SecondActivity的android:taskAffinity改为不同；其余的保持不变！修改后的manifest如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;application android:label=&quot;@string/app_name&quot; android:icon=&quot;@drawable/ic_launcher&quot;&gt;</div><div class="line">    &lt;activity android:name=&quot;ActivityTest&quot;</div><div class="line">              android:taskAffinity=&quot;com.skw.activitytest01&quot;</div><div class="line">              android:label=&quot;@string/app_name&quot;&gt;</div><div class="line">        &lt;intent-filter&gt;</div><div class="line">            &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line">            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line">        &lt;/intent-filter&gt;</div><div class="line">    &lt;/activity&gt;</div><div class="line"></div><div class="line">    &lt;activity android:name=&quot;SecondActivity&quot;</div><div class="line">              android:taskAffinity=&quot;com.skw.activitytest02&quot;</div><div class="line">        /&gt;</div><div class="line">&lt;/application&gt;</div></pre></td></tr></table></figure>
<p>测试内容：ActivityTest –&gt; SecondActivity –&gt; ActivityTest –&gt; SecondActivity<br>测试结果：(01) ActivityTest和SecondActivity在不同task中！ (02) 当第二次进入到ActivityTest中，再企图从ActivityTest中进入到SecondActivity时，没有产生任何效果，仍然停留在ActivityTest中！即第二次ActivityTest –&gt; SecondActivity压根就没发生！<br>结果分析：当相互跳转的两个Activity的android:taskAffinity不同时，添加FLAG_ACTIVITY_NEW_TASK确实产生了一些效果：第一次启动Activity时，会新建一个task，并将Activity添加到该task中。这与singleTask产生的效果是一样的！但是，当企图再次从ActivityTest进入到SecondActivity时，却什么也没有发生！<br>为什么呢？是因为此时SecondActivity实例已经存在，但是它所在的task的栈顶是ActivityTest；而单独的添加FLAG_ACTIVITY_NEW_TASK又不会”删除task中位于SecondActivity之上的Activity实例”，所以就没有发生跳转！</p>
<p>好的，那下面，我们添加FLAG_ACTIVITY_CLEAR_TOP之后，再来看看效果。</p>
<ol>
<li>FLAG_ACTIVITY_CLEAR_TOP标签测试<br>2.1 FLAG_ACTIVITY_CLEAR_TOP示例一<br>点击查看：FLAG_ACTIVITY_CLEAR_TOP示例一的源码。</li>
</ol>
<p>我们修改”FLAG_ACTIVITY_NEW_TASK示例一”中onJump()函数，修改后的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onJump</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class);</div><div class="line">    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK</div><div class="line">            | Intent.FLAG_ACTIVITY_CLEAR_TOP);</div><div class="line">    startActivity(intent);</div><div class="line">&#125; </div><div class="line">```  </div><div class="line">测试内容：ActivityTest --&gt; SecondActivity --&gt; ActivityTest --&gt; SecondActivity</div><div class="line">测试结果：(<span class="number">01</span>) ActivityTest和SecondActivity在同一个task中！ (<span class="number">02</span>) 两个SecondActivity是不同的实例。</div><div class="line">结果分析：这与没有添加FLAG_ACTIVITY_CLEAR_TOP时效果一样！这说明，当相互跳转的两个Activity的android:taskAffinity一样时，不会产生任何效果！</div><div class="line"></div><div class="line">接下来，看看不同android:taskAffinity的情况。</div><div class="line"></div><div class="line"><span class="number">2.2</span> FLAG_ACTIVITY_CLEAR_TOP示例二</div><div class="line">点击查看：FLAG_ACTIVITY_CLEAR_TOP示例二的源码。</div><div class="line"></div><div class="line">我们修改<span class="string">"FLAG_ACTIVITY_NEW_TASK示例一"</span>中onJump()函数，修改后的代码如下：</div><div class="line"></div><div class="line"></div><div class="line">```JAVA</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onJump</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class);</div><div class="line">    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK</div><div class="line">            | Intent.FLAG_ACTIVITY_CLEAR_TOP);</div><div class="line">    startActivity(intent);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试内容：ActivityTest –&gt; SecondActivity –&gt; ActivityTest –&gt; SecondActivity<br>测试结果：(01) ActivityTest和SecondActivity在不同task中！ (02) 两个SecondActivity是同一个实例。<br>结果分析：此时的表现和SecondActivity是singleTask一样！ 这说明，在相互跳转的Activity的android:taskAffinity不同时，同时使用FLAG_ACTIVITY_NEW_TASK和FLAG_ACTIVITY_CLEAR_TOP，才具有和singleTask一样的效果！</p>
<p>总的来说：FLAG_ACTIVITY_NEW_TASK和FLAG_ACTIVITY_CLEAR_TOP的使用和android:taskAffinity相关。在同时使用FLAG_ACTIVITY_NEW_TASK|FLAG_ACTIVITY_CLEAR_TOP的情况下，以A启动B来说<br>(01) 当A和B的taskAffinity相同时：添加FLAG_ACTIVITY_NEW_TASK|FLAG_ACTIVITY_CLEAR_TOP没有任何作用。和没有添加时的效果一样！<br>(02) 当A和B的taskAffinity不同时：添加FLAG_ACTIVITY_NEW_TASK|FLAG_ACTIVITY_CLEAR_TOP后，表现的和B是singleTask一样！</p>
<ol>
<li>FLAG_ACTIVITY_CLEAR_TASK标签测试<br>3.1 FLAG_ACTIVITY_CLEAR_TASK示例一<br>点击查看：FLAG_ACTIVITY_CLEAR_TASK示例一的源码</li>
</ol>
<p>我们修改”FLAG_ACTIVITY_NEW_TASK示例一”中onJump()函数，修改后的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onJump</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class);</div><div class="line">    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK</div><div class="line">            | Intent.FLAG_ACTIVITY_CLEAR_TASK);</div><div class="line">    startActivity(intent);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试内容：ActivityTest –&gt; SecondActivity –&gt; ActivityTest –&gt; SecondActivity<br>测试结果：(01) ActivityTest和SecondActivity在同一个task中！ (02) 两个SecondActivity是不同的实例。<br>结果分析：这与没有添加FLAG_ACTIVITY_CLEAR_TASK时效果一样！这说明，当相互跳转的两个Activity的android:taskAffinity一样时，不会产生任何效果！</p>
<p>接下来，看看不同android:taskAffinity的情况。</p>
<p>3.2 FLAG_ACTIVITY_CLEAR_TASK示例二<br>点击查看：FLAG_ACTIVITY_CLEAR_TASK示例二的源码</p>
<p>我们修改”FLAG_ACTIVITY_NEW_TASK示例一”中onJump()函数，修改后的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onJump</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class);</div><div class="line">    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK</div><div class="line">            | Intent.FLAG_ACTIVITY_CLEAR_TASK);</div><div class="line">    startActivity(intent);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试内容：ActivityTest –&gt; SecondActivity –&gt; ActivityTest –&gt; SecondActivity –&gt; 返回键 –&gt; 返回键<br>测试结果：(01) ActivityTest和SecondActivity在不同的task中！ (02) 两个SecondActivity是不同的实例。 (03) 第一次返回键，返回到第一个ActivityTest中。 (04) 第二次返回键，返回到进入第一个ActivityTest之前的画面。<br>结果分析：当同时使用FLAG_ACTIVITY_NEW_TASK|FLAG_ACTIVITY_CLEAR_TASK时，每次启动Activity时，若该Activity的实例已经存在于某个task中，则清除该task中的全部内容；然后重新创建task并将Activity添加到新建的task中；否则，直接启动新的task并将该Activity添加到新建的task中。</p>
<p>总的来说：FLAG_ACTIVITY_NEW_TASK和FLAG_ACTIVITY_CLEAR_TASK的使用和android:taskAffinity相关。在同时使用FLAG_ACTIVITY_NEW_TASK|FLAG_ACTIVITY_CLEAR_TASK的情况下，以A启动B来说<br>(01) 当A和B的taskAffinity相同时：添加FLAG_ACTIVITY_NEW_TASK|FLAG_ACTIVITY_CLEAR_TASK没有任何作用。和没有添加时的效果一样！<br>(02) 当A和B的taskAffinity不同时：添加FLAG_ACTIVITY_NEW_TASK|FLAG_ACTIVITY_CLEAR_TASK后，启动B时，若该B已经存在于某个task中，则清除该task中的全部内容；然后重新创建task并将B添加到新建的task中；否则，直接启动新的task并将B添加到新建的task中。</p>
<ol>
<li>FLAG_ACTIVITY_SINGLE_TOP标签测试<br>FLAG_ACTIVITY_SINGLE_TOP的特性和launchMode=”singleTop”一样！这里就不做过多的说明了。</li>
</ol>
<p>点击查看：FLAG_ACTIVITY_SINGLE_TOP示例一的源码。该示例中，只有一个Activity示例，点击该Activity会跳转到它自身。</p>
<p>点击查看：FLAG_ACTIVITY_SINGLE_TOP示例二的源码。该示例中，有两个Activity示例，两个Activity之间可以相互跳转。</p>
<h2 id="通过通知进入Activity存在的问题-TaskStackBuilder使用方法"><a href="#通过通知进入Activity存在的问题-TaskStackBuilder使用方法" class="headerlink" title="通过通知进入Activity存在的问题,TaskStackBuilder使用方法"></a>通过通知进入Activity存在的问题,TaskStackBuilder使用方法</h2><p>默认情况下，从通知启动一个Activity，按返回键会回到主屏幕。但某些时候有按返回键仍然留在当前应用的需求。从通知打开的某个深层次Activity。在此Acitivity中点回退，若不做处理，将会直接返回到AndroidLaunch界面。这是因为在Notification中的PendingIntent会默认开启新的任务栈。当回退的时候此任务栈没有其他新的Activity，默认在PendingIntent 的Activity是任务栈中唯一的 Activity.</p>
<p>举例： </p>
<blockquote>
<p>HomeActiy=&gt;Step1Activity=&gt;Step2Acitity<br>某个通知 默认在PendingIntent 指定了Step2Acitity。通过通知栏进入到Step2Acitity。点回退。正常的顺序为：<br>Step2Activity=&gt;Step1Acitivity=&gt;HomeActivity但是如果通过通知栏这样进入Step2Activity 点回退 会直接退回到Android 桌面。就是因为 PendingIntent会默认开启新的任务栈</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Android <span class="number">4.0</span>.3 及更早版本</div><div class="line">&lt;activity</div><div class="line">    android:name=<span class="string">".ResultActivity"</span>&gt;</div><div class="line">    &lt;meta-data</div><div class="line">        android:name=<span class="string">"android.support.PARENT_ACTIVITY"</span></div><div class="line">        android:value=<span class="string">".MainActivity"</span>/&gt;</div><div class="line">&lt;/activity&gt;</div><div class="line">Android <span class="number">4.1</span> 及更高版本</div><div class="line">&lt;activity</div><div class="line">    android:name=<span class="string">".ResultActivity"</span></div><div class="line">    android:parentActivityName=<span class="string">".MainActivity"</span>&gt;</div><div class="line">&lt;/activity&gt;</div></pre></td></tr></table></figure>
<p>代码中做如下处理:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, ResultActivity.class);</div><div class="line">TaskStackBuilder taskStackBuilder = TaskStackBuilder.create(<span class="keyword">this</span>);</div><div class="line">taskStackBuilder.addParentStack(ResultActivity.class);</div><div class="line">taskStackBuilder.addNextIntent(intent);</div><div class="line">PendingIntent pendingIntent = taskStackBuilder.getPendingIntent(<span class="number">1</span>, PendingIntent.FLAG_UPDATE_CURRENT);</div><div class="line">NotificationCompat.Builder notificationBuilder = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>);</div><div class="line">notificationBuilder.setContentIntent(pendingIntent);</div></pre></td></tr></table></figure>
<p>这样从Notification进入到指定的ResultActivity中。回退到正常的MainActivity中。</p>
<h3 id="TaskStackBuilder-扩展应用"><a href="#TaskStackBuilder-扩展应用" class="headerlink" title="TaskStackBuilder 扩展应用"></a>TaskStackBuilder 扩展应用</h3><p>也可以单独使用TaskStackBuilder，让某个二级Acitivity启动的时候启动它的一级Acitity.<br>在 AndroidManifest.xml定义Acitivity从属关系。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;activity</div><div class="line">    android:name=&quot;com.example.app.ChildActivity</div><div class="line">    android:parentActivityName=&quot;com.example.app.ParentActivity&quot; &gt;</div><div class="line">    &lt;!-- 下面这段用来兼容API 16之前的版本 --&gt;</div><div class="line">    &lt;meta-data</div><div class="line">        android:name=&quot;android.support.PARENT_ACTIVITY&quot;</div><div class="line">        android:value=&quot;com.example.app.MainActivity&quot; /&gt;</div><div class="line">&lt;/activity&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//代码中声明如下</div><div class="line">Intent intent = new Intent(this, ChildActivity.class);</div><div class="line">TaskStackBuilder.create(this)</div><div class="line">                .addNextIntentWithParentStack(intent)</div><div class="line">                .startActivities();</div></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Ace
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://zhangbing.cc/2018/09/25/Activity的启动模式/" title=" Activity的启动模式">http://zhangbing.cc/2018/09/25/Activity的启动模式/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/15/JVM：图文解析-Java内存模型-分区/" rel="next" title="JVM：图文解析 Java内存模型 & 分区">
                <i class="fa fa-chevron-left"></i> JVM：图文解析 Java内存模型 & 分区
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/28/git-命令大全/" rel="prev" title="git 命令大全">
                git 命令大全 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head.jpg"
                alt="Ace" />
            
              <p class="site-author-name" itemprop="name">Ace</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="mailto:psel1991@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          
            <div class="cc-license motion-element" itemprop="license">
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
                <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
              </a>
            </div>
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Activity的启动模式"><span class="nav-number">1.</span> <span class="nav-text">Activity的启动模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#任务栈"><span class="nav-number">1.1.</span> <span class="nav-text">任务栈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四个启动模式"><span class="nav-number">1.2.</span> <span class="nav-text">四个启动模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#taskAffinity属性详解"><span class="nav-number">2.</span> <span class="nav-text">taskAffinity属性详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#通过TaskAffinity-设置新的任务栈"><span class="nav-number">2.1.</span> <span class="nav-text">通过TaskAffinity 设置新的任务栈</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#栗子"><span class="nav-number">2.1.1.</span> <span class="nav-text">栗子:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#allowTaskReparenting属性"><span class="nav-number">3.</span> <span class="nav-text">allowTaskReparenting属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Intent与启动模式相关的Flag简介"><span class="nav-number">4.</span> <span class="nav-text">Intent与启动模式相关的Flag简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实例"><span class="nav-number">5.</span> <span class="nav-text">实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过通知进入Activity存在的问题-TaskStackBuilder使用方法"><span class="nav-number">6.</span> <span class="nav-text">通过通知进入Activity存在的问题,TaskStackBuilder使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TaskStackBuilder-扩展应用"><span class="nav-number">6.1.</span> <span class="nav-text">TaskStackBuilder 扩展应用</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ace</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
